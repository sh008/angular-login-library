import { Component, EventEmitter, Input, Output, inject, } from '@angular/core';
import { defaultOptions, mergeLoginOptions, } from './login-lib.interface';
import { Validators, } from '@angular/forms';
import { SocialAuthService } from '@abacritt/angularx-social-login';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "@angular/common";
export class LoginLibComponent {
    //create form
    constructor(fb) {
        this.fb = fb;
        //style input
        this.options = { ...defaultOptions };
        //form variables
        this.submitSpinner = false;
        this.form = this.fb.group({
            username: ['', Validators.required],
            password: ['', Validators.required],
            rememberMe: [false],
        });
        this.loginRes = new EventEmitter();
        //inject google login
        inject(SocialAuthService);
    }
    ngOnInit() { }
    ngOnChanges(changes) {
        this.options = mergeLoginOptions(this.options);
    }
    submit() {
        //check validation
        if (this.form.invalid) {
            this.form.markAllAsTouched();
            return;
        }
        this.submitSpinner = true;
        //set send data
        let data = {};
        data[this.options.usernameBindName] = this.form.get('username')?.value;
        data[this.options.passwordBindName] = this.form.get('username')?.value;
        this.$loginApi(data)?.subscribe({
            next: (res) => {
                this.submitSpinner = false;
                this.tokenHandler(res[this.options.responseTokenKey]);
                this.loginRes.emit({
                    success: true,
                    res,
                });
            },
            error: (err) => {
                this.submitSpinner = false;
                this.loginRes.emit({
                    success: false,
                    res: err,
                });
            },
        });
    }
    tokenHandler(token) {
        const storage = this.form.get('rememberMe')?.value
            ? localStorage
            : sessionStorage;
        storage.setItem('token', token);
    }
}
LoginLibComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.8", ngImport: i0, type: LoginLibComponent, deps: [{ token: i1.FormBuilder }], target: i0.ɵɵFactoryTarget.Component });
LoginLibComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.8", type: LoginLibComponent, selector: "lib-login-sh", inputs: { options: "options", $loginApi: ["loginApi", "$loginApi"] }, outputs: { loginRes: "loginRes" }, usesOnChanges: true, ngImport: i0, template: "<hgroup>\r\n  <h1>{{ options.header }}</h1>\r\n</hgroup>\r\n<form (ngSubmit)=\"submit()\" [formGroup]=\"form\" name=\"loginForm\">\r\n  <div class=\"group\">\r\n    <input class=\"text-box\" formControlName=\"username\" type=\"text\" /><span\r\n      class=\"highlight\"\r\n    ></span\r\n    ><span class=\"bar\"></span>\r\n    <label class=\"input\"\r\n      [ngClass]=\"{\r\n        'text-danger':\r\n          form.get('username')?.touched &&\r\n          form.get('username')?.hasError('required')\r\n      }\"\r\n      >{{ options.usernameLabel }}</label\r\n    >\r\n  </div>\r\n  <div class=\"group\">\r\n    <input class=\"text-box\" formControlName=\"password\" type=\"password\" /><span\r\n      class=\"highlight\"\r\n    ></span\r\n    ><span class=\"bar\"></span>\r\n    <label class=\"input\"\r\n      [ngClass]=\"{\r\n        'text-danger':\r\n          form.get('password')?.touched &&\r\n          form.get('password')?.hasError('required')\r\n      }\"\r\n      >{{ options.passwordLabel }}</label\r\n    >\r\n  </div>\r\n\r\n  <div *ngIf=\"options.rememberMe\" class=\"remember-holder\">\r\n    <label>{{options.rememberMeLabel}}</label>\r\n    <input type=\"checkbox\" formControlName=\"rememberMe\" />\r\n  </div>\r\n\r\n  <button type=\"submit\" class=\"button buttonBlue\" [disabled]=\"submitSpinner\">\r\n    {{ options.submitLabel }}\r\n  </button>\r\n</form>\r\n<!-- footer section -->\r\n<section>\r\n  <span *ngIf=\"options.logo\">\r\n    <img [src]=\"options.logo\" />\r\n  </span>\r\n  <p>\r\n    {{ options.footerLabel }}\r\n  </p>\r\n</section>\r\n\r\n<!-- end footer section -->\r\n", styles: ["*{box-sizing:border-box;direction:rtl;font-family:sans-serif}body{font-family:Helvetica;background:#eee;-webkit-font-smoothing:antialiased}hgroup{text-align:center;margin-top:4em}h1,h3{font-weight:300}h1{color:#636363}h3{color:#4a89dc}form{width:380px;margin:4em auto;padding:3em 2em 2em;background:#fafafa;border:1px solid #ebebeb;box-shadow:#00000026 0 1px 1px,#00000019 0 1px 2px}.group{position:relative;margin-bottom:45px}input.text-box{font-size:18px;padding:10px 10px 10px 5px;-webkit-appearance:none;display:block;background:#fafafa;color:#636363;width:100%;border:none;border-radius:0;border-bottom:1px solid #757575}input.text-box:focus{outline:none}label.input{color:#999;font-size:18px;font-weight:400;position:absolute;pointer-events:none;right:5px;top:-20px;transition:all .2s ease;transform:scale(.75)}input.text-box:focus~label.input.text-box,input.text-box.used~label.input.text-box{top:-20px;transform:scale(1);right:-2px;color:#4a89dc}.bar{position:relative;display:block;width:100%}.bar:before,.bar:after{content:\"\";height:2px;width:0;bottom:1px;position:absolute;background:#4a89dc;transition:all .2s ease}.bar:before{right:50%}.bar:after{left:50%}input.text-box:focus~.bar:before,input.text-box:focus~.bar:after{width:50%}.highlight{position:absolute;height:60%;width:100px;top:25%;right:0;pointer-events:none;opacity:.5}input.text-box:focus~.highlight{animation:input.text-boxHighlighter .3s ease}@keyframes input.text-boxHighlighter{from {background: #4a89dc;} to {width: 0; background: transparent;}}.button{position:relative;display:inline-block;padding:12px 24px;margin:.3em 0 1em;width:100%;vertical-align:middle;color:#fff;font-size:16px;line-height:20px;-webkit-font-smoothing:antialiased;text-align:center;letter-spacing:1px;background:transparent;border:0;border-bottom:2px solid #3160b6;cursor:pointer;transition:all .15s ease}.button:focus{outline:0}.buttonBlue{background:#4a89dc;text-shadow:1px 1px 0 rgba(39,110,204,.5)}.buttonBlue:hover{background:#357bd8}.ripples{position:absolute;top:0;right:0;width:100%;height:100%;overflow:hidden;background:transparent}.ripplesCircle{position:absolute;top:50%;right:50%;transform:translate(-50%,-50%);opacity:0;width:0;height:0;border-radius:50%;background:rgba(255,255,255,.25)}.ripples.is-active .ripplesCircle{animation:ripples .4s ease-in}@keyframes ripples{0%{opacity:0}25%{opacity:1}to{width:200%;padding-bottom:200%;opacity:0}}section{text-align:center}section p{color:#888;font-size:13px;letter-spacing:.4px}section a{color:#4a89dc;text-decoration:none;transition:all .2s ease}section a:hover{color:#666;text-decoration:underline}section img{width:80px;transition:all .2s ease}section img:hover{opacity:.83}section img:focus,section a:focus{outline:none}section p{text-align:center}.text-danger{color:red!important}button:disabled,button[disabled]{background-color:#ccc;color:#666}.remember-holder{margin-bottom:15px}\n"], dependencies: [{ kind: "directive", type: i2.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i1.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i1.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i1.CheckboxControlValueAccessor, selector: "input[type=checkbox][formControlName],input[type=checkbox][formControl],input[type=checkbox][ngModel]" }, { kind: "directive", type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i1.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i1.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i1.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.8", ngImport: i0, type: LoginLibComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lib-login-sh', template: "<hgroup>\r\n  <h1>{{ options.header }}</h1>\r\n</hgroup>\r\n<form (ngSubmit)=\"submit()\" [formGroup]=\"form\" name=\"loginForm\">\r\n  <div class=\"group\">\r\n    <input class=\"text-box\" formControlName=\"username\" type=\"text\" /><span\r\n      class=\"highlight\"\r\n    ></span\r\n    ><span class=\"bar\"></span>\r\n    <label class=\"input\"\r\n      [ngClass]=\"{\r\n        'text-danger':\r\n          form.get('username')?.touched &&\r\n          form.get('username')?.hasError('required')\r\n      }\"\r\n      >{{ options.usernameLabel }}</label\r\n    >\r\n  </div>\r\n  <div class=\"group\">\r\n    <input class=\"text-box\" formControlName=\"password\" type=\"password\" /><span\r\n      class=\"highlight\"\r\n    ></span\r\n    ><span class=\"bar\"></span>\r\n    <label class=\"input\"\r\n      [ngClass]=\"{\r\n        'text-danger':\r\n          form.get('password')?.touched &&\r\n          form.get('password')?.hasError('required')\r\n      }\"\r\n      >{{ options.passwordLabel }}</label\r\n    >\r\n  </div>\r\n\r\n  <div *ngIf=\"options.rememberMe\" class=\"remember-holder\">\r\n    <label>{{options.rememberMeLabel}}</label>\r\n    <input type=\"checkbox\" formControlName=\"rememberMe\" />\r\n  </div>\r\n\r\n  <button type=\"submit\" class=\"button buttonBlue\" [disabled]=\"submitSpinner\">\r\n    {{ options.submitLabel }}\r\n  </button>\r\n</form>\r\n<!-- footer section -->\r\n<section>\r\n  <span *ngIf=\"options.logo\">\r\n    <img [src]=\"options.logo\" />\r\n  </span>\r\n  <p>\r\n    {{ options.footerLabel }}\r\n  </p>\r\n</section>\r\n\r\n<!-- end footer section -->\r\n", styles: ["*{box-sizing:border-box;direction:rtl;font-family:sans-serif}body{font-family:Helvetica;background:#eee;-webkit-font-smoothing:antialiased}hgroup{text-align:center;margin-top:4em}h1,h3{font-weight:300}h1{color:#636363}h3{color:#4a89dc}form{width:380px;margin:4em auto;padding:3em 2em 2em;background:#fafafa;border:1px solid #ebebeb;box-shadow:#00000026 0 1px 1px,#00000019 0 1px 2px}.group{position:relative;margin-bottom:45px}input.text-box{font-size:18px;padding:10px 10px 10px 5px;-webkit-appearance:none;display:block;background:#fafafa;color:#636363;width:100%;border:none;border-radius:0;border-bottom:1px solid #757575}input.text-box:focus{outline:none}label.input{color:#999;font-size:18px;font-weight:400;position:absolute;pointer-events:none;right:5px;top:-20px;transition:all .2s ease;transform:scale(.75)}input.text-box:focus~label.input.text-box,input.text-box.used~label.input.text-box{top:-20px;transform:scale(1);right:-2px;color:#4a89dc}.bar{position:relative;display:block;width:100%}.bar:before,.bar:after{content:\"\";height:2px;width:0;bottom:1px;position:absolute;background:#4a89dc;transition:all .2s ease}.bar:before{right:50%}.bar:after{left:50%}input.text-box:focus~.bar:before,input.text-box:focus~.bar:after{width:50%}.highlight{position:absolute;height:60%;width:100px;top:25%;right:0;pointer-events:none;opacity:.5}input.text-box:focus~.highlight{animation:input.text-boxHighlighter .3s ease}@keyframes input.text-boxHighlighter{from {background: #4a89dc;} to {width: 0; background: transparent;}}.button{position:relative;display:inline-block;padding:12px 24px;margin:.3em 0 1em;width:100%;vertical-align:middle;color:#fff;font-size:16px;line-height:20px;-webkit-font-smoothing:antialiased;text-align:center;letter-spacing:1px;background:transparent;border:0;border-bottom:2px solid #3160b6;cursor:pointer;transition:all .15s ease}.button:focus{outline:0}.buttonBlue{background:#4a89dc;text-shadow:1px 1px 0 rgba(39,110,204,.5)}.buttonBlue:hover{background:#357bd8}.ripples{position:absolute;top:0;right:0;width:100%;height:100%;overflow:hidden;background:transparent}.ripplesCircle{position:absolute;top:50%;right:50%;transform:translate(-50%,-50%);opacity:0;width:0;height:0;border-radius:50%;background:rgba(255,255,255,.25)}.ripples.is-active .ripplesCircle{animation:ripples .4s ease-in}@keyframes ripples{0%{opacity:0}25%{opacity:1}to{width:200%;padding-bottom:200%;opacity:0}}section{text-align:center}section p{color:#888;font-size:13px;letter-spacing:.4px}section a{color:#4a89dc;text-decoration:none;transition:all .2s ease}section a:hover{color:#666;text-decoration:underline}section img{width:80px;transition:all .2s ease}section img:hover{opacity:.83}section img:focus,section a:focus{outline:none}section p{text-align:center}.text-danger{color:red!important}button:disabled,button[disabled]{background-color:#ccc;color:#666}.remember-holder{margin-bottom:15px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.FormBuilder }]; }, propDecorators: { options: [{
                type: Input
            }], $loginApi: [{
                type: Input,
                args: ['loginApi']
            }], loginRes: [{
                type: Output,
                args: ['loginRes']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9naW4tbGliLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL2xvZ2luLWxpYi9zcmMvbGliL2xvZ2luLWxpYi5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9sb2dpbi1saWIvc3JjL2xpYi9sb2dpbi1saWIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxZQUFZLEVBQ1osS0FBSyxFQUdMLE1BQU0sRUFFTixNQUFNLEdBQ1AsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUdMLGNBQWMsRUFDZCxpQkFBaUIsR0FDbEIsTUFBTSx1QkFBdUIsQ0FBQztBQUUvQixPQUFPLEVBSUwsVUFBVSxHQUNYLE1BQU0sZ0JBQWdCLENBQUM7QUFFeEIsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUNBQWlDLENBQUM7Ozs7QUFPcEUsTUFBTSxPQUFPLGlCQUFpQjtJQUU1QixhQUFhO0lBQ2IsWUFBb0IsRUFBZTtRQUFmLE9BQUUsR0FBRixFQUFFLENBQWE7UUFlbkMsYUFBYTtRQUNKLFlBQU8sR0FBaUIsRUFBRSxHQUFHLGNBQWMsRUFBRSxDQUFDO1FBUXZELGdCQUFnQjtRQUNoQixrQkFBYSxHQUFZLEtBQUssQ0FBQztRQXhCN0IsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQztZQUN4QixRQUFRLEVBQUUsQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBQztZQUNuQyxRQUFRLEVBQUUsQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBQztZQUNuQyxVQUFVLEVBQUUsQ0FBQyxLQUFLLENBQUM7U0FDcEIsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBR25DLHFCQUFxQjtRQUNyQixNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBZ0JELFFBQVEsS0FBVSxDQUFDO0lBRW5CLFdBQVcsQ0FBQyxPQUFzQjtRQUNoQyxJQUFJLENBQUMsT0FBTyxHQUFHLGlCQUFpQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBRUQsTUFBTTtRQUNKLGtCQUFrQjtRQUNsQixJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUM3QixPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQztRQUUxQixlQUFlO1FBQ2YsSUFBSSxJQUFJLEdBQVEsRUFBRSxDQUFDO1FBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEVBQUUsS0FBSyxDQUFDO1FBQ3ZFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEVBQUUsS0FBSyxDQUFDO1FBRXZFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsU0FBUyxDQUFDO1lBQzlCLElBQUksRUFBRSxDQUFDLEdBQVEsRUFBRSxFQUFFO2dCQUNqQixJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztnQkFDM0IsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RELElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO29CQUNqQixPQUFPLEVBQUUsSUFBSTtvQkFDYixHQUFHO2lCQUNKLENBQUMsQ0FBQztZQUNMLENBQUM7WUFDRCxLQUFLLEVBQUUsQ0FBQyxHQUFRLEVBQUUsRUFBRTtnQkFDbEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7Z0JBQzNCLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO29CQUNqQixPQUFPLEVBQUUsS0FBSztvQkFDZCxHQUFHLEVBQUUsR0FBRztpQkFDVCxDQUFDLENBQUM7WUFDTCxDQUFDO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELFlBQVksQ0FBQyxLQUFhO1FBQ3hCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxFQUFFLEtBQUs7WUFDaEQsQ0FBQyxDQUFDLFlBQVk7WUFDZCxDQUFDLENBQUMsY0FBYyxDQUFDO1FBQ25CLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ2xDLENBQUM7OzhHQTNFVSxpQkFBaUI7a0dBQWpCLGlCQUFpQixrTENoQzlCLGlsREFxREE7MkZEckJhLGlCQUFpQjtrQkFMN0IsU0FBUzsrQkFDRSxjQUFjO2tHQXVCZixPQUFPO3NCQUFmLEtBQUs7Z0JBR2EsU0FBUztzQkFBM0IsS0FBSzt1QkFBQyxVQUFVO2dCQUdHLFFBQVE7c0JBQTNCLE1BQU07dUJBQUMsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgaW5qZWN0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIElMb2dpblJlcyxcbiAgTG9naW5PcHRpb25zLFxuICBkZWZhdWx0T3B0aW9ucyxcbiAgbWVyZ2VMb2dpbk9wdGlvbnMsXG59IGZyb20gJy4vbG9naW4tbGliLmludGVyZmFjZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge1xuICBGb3JtQnVpbGRlcixcbiAgRm9ybUNvbnRyb2wsXG4gIEZvcm1Hcm91cCxcbiAgVmFsaWRhdG9ycyxcbn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuXG5pbXBvcnQgeyBTb2NpYWxBdXRoU2VydmljZSB9IGZyb20gJ0BhYmFjcml0dC9hbmd1bGFyeC1zb2NpYWwtbG9naW4nO1xuaW1wb3J0IHsgR29vZ2xlTG9naW5Qcm92aWRlciB9IGZyb20gJ0BhYmFjcml0dC9hbmd1bGFyeC1zb2NpYWwtbG9naW4nO1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbGliLWxvZ2luLXNoJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xvZ2luLWxpYi5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2xvZ2luLWxpYi5jb21wb25lbnQuY3NzJ10sXG59KVxuZXhwb3J0IGNsYXNzIExvZ2luTGliQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuXG4gIC8vY3JlYXRlIGZvcm1cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBmYjogRm9ybUJ1aWxkZXIpIHtcbiAgICB0aGlzLmZvcm0gPSB0aGlzLmZiLmdyb3VwKHtcbiAgICAgIHVzZXJuYW1lOiBbJycsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgICAgcGFzc3dvcmQ6IFsnJywgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXG4gICAgICByZW1lbWJlck1lOiBbZmFsc2VdLFxuICAgIH0pO1xuXG4gICAgdGhpcy5sb2dpblJlcyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuXG4gICAgLy9pbmplY3QgZ29vZ2xlIGxvZ2luXG4gICAgaW5qZWN0KFNvY2lhbEF1dGhTZXJ2aWNlKTtcbiAgfVxuXG5cbiAgLy9zdHlsZSBpbnB1dFxuICBASW5wdXQoKSBvcHRpb25zOiBMb2dpbk9wdGlvbnMgPSB7IC4uLmRlZmF1bHRPcHRpb25zIH07XG5cbiAgLy9vYnNlcnZlciBsb2dpbiBhcGkgaW5wdXRcbiAgQElucHV0KCdsb2dpbkFwaScpICRsb2dpbkFwaT86IGFueTtcblxuICAvL3NlbmQgbG9naW4gQXBpIHJlc1xuICBAT3V0cHV0KCdsb2dpblJlcycpIGxvZ2luUmVzOiBFdmVudEVtaXR0ZXI8SUxvZ2luUmVzPjtcblxuICAvL2Zvcm0gdmFyaWFibGVzXG4gIHN1Ym1pdFNwaW5uZXI6IGJvb2xlYW4gPSBmYWxzZTtcbiAgZm9ybTogRm9ybUdyb3VwO1xuXG4gIG5nT25Jbml0KCk6IHZvaWQge31cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgdGhpcy5vcHRpb25zID0gbWVyZ2VMb2dpbk9wdGlvbnModGhpcy5vcHRpb25zKTtcbiAgfVxuXG4gIHN1Ym1pdCgpIHtcbiAgICAvL2NoZWNrIHZhbGlkYXRpb25cbiAgICBpZiAodGhpcy5mb3JtLmludmFsaWQpIHtcbiAgICAgIHRoaXMuZm9ybS5tYXJrQWxsQXNUb3VjaGVkKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5zdWJtaXRTcGlubmVyID0gdHJ1ZTtcblxuICAgIC8vc2V0IHNlbmQgZGF0YVxuICAgIGxldCBkYXRhOiBhbnkgPSB7fTtcbiAgICBkYXRhW3RoaXMub3B0aW9ucy51c2VybmFtZUJpbmROYW1lXSA9IHRoaXMuZm9ybS5nZXQoJ3VzZXJuYW1lJyk/LnZhbHVlO1xuICAgIGRhdGFbdGhpcy5vcHRpb25zLnBhc3N3b3JkQmluZE5hbWVdID0gdGhpcy5mb3JtLmdldCgndXNlcm5hbWUnKT8udmFsdWU7XG5cbiAgICB0aGlzLiRsb2dpbkFwaShkYXRhKT8uc3Vic2NyaWJlKHtcbiAgICAgIG5leHQ6IChyZXM6IGFueSkgPT4ge1xuICAgICAgICB0aGlzLnN1Ym1pdFNwaW5uZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy50b2tlbkhhbmRsZXIocmVzW3RoaXMub3B0aW9ucy5yZXNwb25zZVRva2VuS2V5XSk7XG4gICAgICAgIHRoaXMubG9naW5SZXMuZW1pdCh7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICByZXMsXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIGVycm9yOiAoZXJyOiBhbnkpID0+IHtcbiAgICAgICAgdGhpcy5zdWJtaXRTcGlubmVyID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9naW5SZXMuZW1pdCh7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgcmVzOiBlcnIsXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHRva2VuSGFuZGxlcih0b2tlbjogc3RyaW5nKSB7XG4gICAgY29uc3Qgc3RvcmFnZSA9IHRoaXMuZm9ybS5nZXQoJ3JlbWVtYmVyTWUnKT8udmFsdWVcbiAgICAgID8gbG9jYWxTdG9yYWdlXG4gICAgICA6IHNlc3Npb25TdG9yYWdlO1xuICAgIHN0b3JhZ2Uuc2V0SXRlbSgndG9rZW4nLCB0b2tlbik7XG4gIH1cblxufVxuIiwiPGhncm91cD5cclxuICA8aDE+e3sgb3B0aW9ucy5oZWFkZXIgfX08L2gxPlxyXG48L2hncm91cD5cclxuPGZvcm0gKG5nU3VibWl0KT1cInN1Ym1pdCgpXCIgW2Zvcm1Hcm91cF09XCJmb3JtXCIgbmFtZT1cImxvZ2luRm9ybVwiPlxyXG4gIDxkaXYgY2xhc3M9XCJncm91cFwiPlxyXG4gICAgPGlucHV0IGNsYXNzPVwidGV4dC1ib3hcIiBmb3JtQ29udHJvbE5hbWU9XCJ1c2VybmFtZVwiIHR5cGU9XCJ0ZXh0XCIgLz48c3BhblxyXG4gICAgICBjbGFzcz1cImhpZ2hsaWdodFwiXHJcbiAgICA+PC9zcGFuXHJcbiAgICA+PHNwYW4gY2xhc3M9XCJiYXJcIj48L3NwYW4+XHJcbiAgICA8bGFiZWwgY2xhc3M9XCJpbnB1dFwiXHJcbiAgICAgIFtuZ0NsYXNzXT1cIntcclxuICAgICAgICAndGV4dC1kYW5nZXInOlxyXG4gICAgICAgICAgZm9ybS5nZXQoJ3VzZXJuYW1lJyk/LnRvdWNoZWQgJiZcclxuICAgICAgICAgIGZvcm0uZ2V0KCd1c2VybmFtZScpPy5oYXNFcnJvcigncmVxdWlyZWQnKVxyXG4gICAgICB9XCJcclxuICAgICAgPnt7IG9wdGlvbnMudXNlcm5hbWVMYWJlbCB9fTwvbGFiZWxcclxuICAgID5cclxuICA8L2Rpdj5cclxuICA8ZGl2IGNsYXNzPVwiZ3JvdXBcIj5cclxuICAgIDxpbnB1dCBjbGFzcz1cInRleHQtYm94XCIgZm9ybUNvbnRyb2xOYW1lPVwicGFzc3dvcmRcIiB0eXBlPVwicGFzc3dvcmRcIiAvPjxzcGFuXHJcbiAgICAgIGNsYXNzPVwiaGlnaGxpZ2h0XCJcclxuICAgID48L3NwYW5cclxuICAgID48c3BhbiBjbGFzcz1cImJhclwiPjwvc3Bhbj5cclxuICAgIDxsYWJlbCBjbGFzcz1cImlucHV0XCJcclxuICAgICAgW25nQ2xhc3NdPVwie1xyXG4gICAgICAgICd0ZXh0LWRhbmdlcic6XHJcbiAgICAgICAgICBmb3JtLmdldCgncGFzc3dvcmQnKT8udG91Y2hlZCAmJlxyXG4gICAgICAgICAgZm9ybS5nZXQoJ3Bhc3N3b3JkJyk/Lmhhc0Vycm9yKCdyZXF1aXJlZCcpXHJcbiAgICAgIH1cIlxyXG4gICAgICA+e3sgb3B0aW9ucy5wYXNzd29yZExhYmVsIH19PC9sYWJlbFxyXG4gICAgPlxyXG4gIDwvZGl2PlxyXG5cclxuICA8ZGl2ICpuZ0lmPVwib3B0aW9ucy5yZW1lbWJlck1lXCIgY2xhc3M9XCJyZW1lbWJlci1ob2xkZXJcIj5cclxuICAgIDxsYWJlbD57e29wdGlvbnMucmVtZW1iZXJNZUxhYmVsfX08L2xhYmVsPlxyXG4gICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIGZvcm1Db250cm9sTmFtZT1cInJlbWVtYmVyTWVcIiAvPlxyXG4gIDwvZGl2PlxyXG5cclxuICA8YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiBjbGFzcz1cImJ1dHRvbiBidXR0b25CbHVlXCIgW2Rpc2FibGVkXT1cInN1Ym1pdFNwaW5uZXJcIj5cclxuICAgIHt7IG9wdGlvbnMuc3VibWl0TGFiZWwgfX1cclxuICA8L2J1dHRvbj5cclxuPC9mb3JtPlxyXG48IS0tIGZvb3RlciBzZWN0aW9uIC0tPlxyXG48c2VjdGlvbj5cclxuICA8c3BhbiAqbmdJZj1cIm9wdGlvbnMubG9nb1wiPlxyXG4gICAgPGltZyBbc3JjXT1cIm9wdGlvbnMubG9nb1wiIC8+XHJcbiAgPC9zcGFuPlxyXG4gIDxwPlxyXG4gICAge3sgb3B0aW9ucy5mb290ZXJMYWJlbCB9fVxyXG4gIDwvcD5cclxuPC9zZWN0aW9uPlxyXG5cclxuPCEtLSBlbmQgZm9vdGVyIHNlY3Rpb24gLS0+XHJcbiJdfQ==